!function(){"use strict";angular.module("frontend",["ngAnimate","ngSanitize","ngResource","ui.router","weed","frontend.api","frontend.common","frontend.socket","frontend.interceptors","ngFileUpload","chart.js","720kb.datepicker"])}(),function(t){"use strict";function e(t,e,n,i,o,r,s,a){var c=this;c.notifications=[],c.showReaded=!1,c.actualNotificationsLength=0,r.locale("es"),c.fetchNotifications=function(){a.get({},function(t){e.log(t),c.alerts=t.data})},c.readNotification=function(t){alert("marking as read: "+t)},c.readNotification=function(t){},c.fetchNotifications()}t.module("frontend").controller("NotificationsController",e),e.$inject=["$scope","$log","$q","$stateParams","$state","moment","WeedApi","ApiAllNotifications"]}(angular),function(t){"use strict";function e(t,e,n,i,o,r,s,a,c,l){function u(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}function d(){var t=l,n="room_meter:"+e.id;m=t.channel(n,{}),m.join().receive("ok",function(t){}).receive("error",function(t){console.log("Unable to join",t)})}function p(t,e){for(var n=new Date(h.initialTime.getTime()),i=[],o=new Date(h.endTime.getTime()),r=new Date(h.initialTime.getTime()),s=0,a=[];o>r;){r.setMinutes(r.getMinutes()+e);var c=-1,l=r;c=0==i?n:i[s-1],i.push(new Date(r.getTime()));var u=f(t,c,l);if(0==u)a.length>0?(d=a[s-1].level,a.push({time:r,level:d})):a.push({time:r,level:void 0});else{for(var d=0,p=0;p<u.length;p++)d+=u[p].level;d/=u.length,a.push({time:new Date(r.getTime()),level:d})}s++}return a}function f(t,e,n){for(var i=[],o=0;o<t.length;o++)t[o].time>=e&&t[o].time<=n&&i.push(t[o]);return i}var h=this;h.display_mode="date",h.endTime=new Date,h.endTimeHours=new Date,h.endTimeInput=s(h.endTime).format("HH:mm"),h.initialTime=new Date,h.initialTimeHours=new Date,h.initialTime.setDate(h.initialTime.getDate()-1),h.initialTimeHours.setDate(h.initialTimeHours.getDate()-1),h.initialTimeInput=s(h.initialTime).format("HH:mm");var m={};d(),h.sendSocketData=function(){var t=u(5,50),n=u(18,45);console.log("Sending DATA: ",t),m.push("create:entry",{entry:{meter_id:e.id,sonnar:t,temperature:n}})},m.on("create:entry",function(t){h.endTime=new Date,h.endTime.setMinutes(h.endTime.getMinutes()+10),h.initialTime=new Date,h.initialTime.setMinutes(h.initialTime.getMinutes()+10),h.initialTime.setHours(h.initialTime.getHours()-1),n.log("received entry"),h.fetchMeterData()}),h.fetchMeterData=function(){new a.get({id:e.id}).$promise.then(function(t){h.meter=t.data},function(t){}).then(function(){h.meterEntries=new c,h.meterEntries.meter_id=parseInt(e.id),h.meterEntries.begin_date=s(h.initialTime).format("YYYY-MM-DDTHH:mm:ssZ"),h.meterEntries.end_date=s(h.endTime).format("YYYY-MM-DDTHH:mm:ssZ"),h.meterEntries.$save(function(t){n.log(t);var e=t.data;h.currentEntries=[],h.logEntries=[];for(var i=0;i<e.length;i++){var o=e[i].inserted_at,r=new Date(o);h.currentEntries.push({time:r,level:e[i].sonnar}),h.logEntries.push({time:r,level:e[i].sonnar,temperature:e[i].temperature})}n.log("new first: ",h.currentEntries[0]);var s=p(h.currentEntries,5);h.data=[];for(var i=0;i<s.length;i++)h.data.push({x:s[i].time,y:s[i].level});h.data.sort(function(t,e){return new Date(e.x)-new Date(t.x)}),n.log("DATA",h.data),h.updateChartOptions()},function(t){n.log(t)})})},h.refreshGrid=function(){if("hours"==h.display_mode){var t=h.endTimeHours.getHours(),e=h.endTimeHours.getMinutes();h.endTime.setHours(t),h.endTime.setMinutes(e);var n=h.initialTimeHours.getHours(),i=h.initialTimeHours.getMinutes();h.initialTime.setHours(n),h.initialTime.setMinutes(i),h.updateChartOptions()}else h.updateChartOptions()},h.changeInputs=function(){},h.updateChartOptions=function(){"hours"==h.display_mode?h.options={type:"line",fill:!1,backgroundColor:"transparent",scales:{xAxes:[{type:"time",time:{unit:"hour",min:h.initialTime,max:h.endTime},position:"bottom"}]}}:h.options={type:"line",fill:!1,backgroundColor:"transparent",scales:{xAxes:[{type:"time",time:{unit:"day",min:h.initialTime,max:h.endTime},position:"bottom"}]}}},h.setTankFull=function(){r.publish("main-notification",{text:"El tanque fue establecido como lleno",color:"success",icon:"cog",timeout:2e3}),r.closeActiveElements()},h.fetchMeterData()}t.module("frontend").controller("MeterController",e),e.$inject=["$scope","$stateParams","$log","$state","ApiGetAllMeters","WeedApi","moment","ApiGetMeter","ApiGetMeterEntries","Socket"]}(angular),function(t){"use strict";function e(t,e,n,i,o){function r(){return i.get({},function(t){e.log(t),a.meterList=t.data,e.log("meterssss"),e.log(a.meterList)}),[]}function s(){a.regions=["All","Guatemala","Peten","Izabal","Zacapa"]}var a=this;a.selectedRegion="All",s(),r()}t.module("frontend").controller("MeterListController",e),e.$inject=["$scope","$log","$state","ApiGetAllMeters","WeedApi"]}(angular),function(t){"use strict";function e(t){t.state("notifications",{url:"/user/notifications",templateUrl:"app/views/user/notifications/index.html",controller:"NotificationsController",controllerAs:"ctrl",data:{cssClassnames:"dashboard notifications"}})}t.module("frontend").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(angular),function(t){"use strict";function e(t){t.state("metersHome",{url:"/",templateUrl:"app/views/predictions/all-predictions/index.html",controller:"MeterListController",controllerAs:"ctrl",data:{cssClassnames:"dashboard start"}}).state("meters",{url:"/predictions",templateUrl:"app/views/predictions/all-predictions/index.html",controller:"MeterListController",controllerAs:"ctrl",data:{cssClassnames:"dashboard start"}}).state("meter",{url:"/prediction1/:id",templateUrl:"app/views/predictions/prediction1/index.html",controller:"MeterController",controllerAs:"ctrl",data:{cssClassnames:"dashboard start"}})}t.module("frontend").config(e),e.$inject=["$stateProvider"]}(angular),function(t){"use strict";function e(t,e,n){return t([e,"notifications/"].join(""),n)}t.module("api.ApiAllNotifications",[]).factory("ApiAllNotifications",e),e.$inject=["$resource","resourceApi","resourceActions"]}(angular),function(t){"use strict";function e(t,e,n){return t([e,"regions/"].join(""),{},n)}t.module("api.ApiGetRegions",[]).factory("ApiGetRegions",e),e.$inject=["$resource","resourceApi","resourceActions"]}(angular),function(t){"use strict";function e(t,e,n){return t([e,"prediction1/:id"].join(""),{id:"@id"},n)}t.module("api.ApiGetMeter",[]).factory("ApiGetMeter",e),e.$inject=["$resource","resourceApi","resourceActions"]}(angular),function(t){"use strict";function e(t,e,n){return t([e,"entry/meter_range"].join(""),{},n)}t.module("api.ApiGetMeterEntries",[]).factory("ApiGetMeterEntries",e),e.$inject=["$resource","resourceApi","resourceActions"]}(angular),function(t){"use strict";function e(t,e,n){return t([e,"prediction1/"].join(""),n)}t.module("api.ApiGetAllMeters",[]).factory("ApiGetAllMeters",e),e.$inject=["$resource","resourceApi","resourceActions"]}(angular),function(t){"use strict";function e(t){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ngEnter,{event:e})}),e.preventDefault())})}}t.module("frontend.common.manageEnter",[]).directive("ngEnter",e),e.$inject=["$log"]}(angular),function(t){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"app/components/sidebar/sidebar.html",controller:n,controllerAs:"ctrl"}}function n(t,e,n){var i=this;i.stateNum=-1,i.state=t;var o=t.current.name.split("-");"board"==o[0]?i.stateNum=1:"committee"==o[0]?i.stateNum=2:i.stateNum=3,i.idState=e.id}t.module("frontend.common.sidebar",["weed"]).directive("sidebar",e),n.$inject=["$state","$stateParams","$log"]}(angular),function(t){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"app/components/navbar/navbar.html",controller:n,controllerAs:"ctrl"}}function n(t,e,n,i,o,r,s,a,c,l){function u(){l.get({},function(t){e.log("notifications",t.data),p.notificationsDisplay=t.data,p.readNotifications=[];for(var n=0;n<p.notificationsDisplay.length;n++)p.notificationsDisplay[n].isRead&&p.readNotifications.push(p.notificationsDisplay[n])})}function d(){var t=a,n="notification:lobby"+o.id;e.log(n),f=t.channel(n,{}),f.join().receive("ok",function(t){e.log("CONNECTED TO NOTIFICATION LOBBY")}).receive("error",function(t){console.log("Unable to join",t)})}var p=this,f={};d(),f.on("new:msg",function(t){e.log("RECEVIED MSG: ",t)}),u()}t.module("frontend.common.navbar",["weed"]).directive("navbar",e),n.$inject=["$attrs","$log","$state","$rootScope","$stateParams","moment","$location","Socket","WeedApi","ApiAllNotifications"]}(angular),angular.module("frontend.interceptors",["frontend.interceptor.interceptor1","frontend.interceptor.interceptor2"]),function(t){"use strict";function e(t,e){return{request:function(t){return t},response:function(t){return t}}}t.module("frontend.interceptor.interceptor1",[]).factory("customInterceptor",e),e.$inject=["$injector","$log"]}(angular),function(t){"use strict";function e(t,e,n){return{request:function(t){return t},response:function(t){return t},responseError:function(t){}}}t.module("frontend.interceptor.interceptor2",[]).factory("authRedirectInterceptor",e),e.$inject=["$injector","$log","WeedApi"]}(angular),function(t){"use strict";t.module("frontend").constant("resourceActions",{update:{method:"PUT"},query:{isArray:!1}}).constant("resourceApi","http://52.203.56.116:4000/api/")}(angular),function(t){"use strict";function e(t,e,i,o){t.html5Mode(!1),i.otherwise("/"),e.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginControl",onExit:n,controllerAs:"ctrl"}).state("notification",{url:"/",templateUrl:"views/notification.html",controller:"NotificationController",onExit:n,controllerAs:"ctrl"})}t.module("PhoenixSocket",["lbServices","ui.router"]).config(e),e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$httpProvider"];var n=function(t){};n.$inject=["PubSub"]}(angular),function(t){"use strict";function e(t){var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return"undefined"==typeof t?"undefined":e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":"undefined"==typeof t?"undefined":e(t)},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(t,"__esModule",{value:!0});var s="1.0.0",a={connecting:0,open:1,closing:2,closed:3},c=1e4,l={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},u={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},d={longpoll:"longpoll",websocket:"websocket"},p=function(){function t(e,n,o,r){i(this,t),this.channel=e,this.event=n,this.payload=o||{},this.receivedResp=null,this.timeout=r,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}return r(t,[{key:"resend",value:function(t){this.timeout=t,this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}},{key:"receive",value:function(t,e){return this.hasReceived(t)&&e(this.receivedResp.response),this.recHooks.push({status:t,callback:e}),this}},{key:"matchReceive",value:function(t){var e=t.status,n=t.response;t.ref;this.recHooks.filter(function(t){return t.status===e}).forEach(function(t){return t.callback(n)})}},{key:"cancelRefEvent",value:function(){this.refEvent&&this.channel.off(this.refEvent)}},{key:"cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}},{key:"startTimeout",value:function(){var t=this;this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,function(e){t.cancelRefEvent(),t.cancelTimeout(),t.receivedResp=e,t.matchReceive(e)}),this.timeoutTimer=setTimeout(function(){t.trigger("timeout",{})},this.timeout))}},{key:"hasReceived",value:function(t){return this.receivedResp&&this.receivedResp.status===t}},{key:"trigger",value:function(t,e){this.channel.trigger(this.refEvent,{status:t,response:e})}}]),t}(),f=t.Channel=function(){function t(e,n,o){var r=this;i(this,t),this.state=l.closed,this.topic=e,this.params=n||{},this.socket=o,this.bindings=[],this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new p(this,u.join,this.params,this.timeout),this.pushBuffer=[],this.rejoinTimer=new v(function(){return r.rejoinUntilConnected()},this.socket.reconnectAfterMs),this.joinPush.receive("ok",function(){r.state=l.joined,r.rejoinTimer.reset(),r.pushBuffer.forEach(function(t){return t.send()}),r.pushBuffer=[]}),this.onClose(function(){r.rejoinTimer.reset(),r.socket.log("channel","close "+r.topic+" "+r.joinRef()),r.state=l.closed,r.socket.remove(r)}),this.onError(function(t){r.isLeaving()||r.isClosed()||(r.socket.log("channel","error "+r.topic,t),r.state=l.errored,r.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",function(){r.isJoining()&&(r.socket.log("channel","timeout "+r.topic,r.joinPush.timeout),r.state=l.errored,r.rejoinTimer.scheduleTimeout())}),this.on(u.reply,function(t,e){r.trigger(r.replyEventName(e),t)})}return r(t,[{key:"rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}},{key:"join",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.timeout:arguments[0];if(this.joinedOnce)throw"tried to join multiple times. 'join' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(t),this.joinPush}},{key:"onClose",value:function(t){this.on(u.close,t)}},{key:"onError",value:function(t){this.on(u.error,function(e){return t(e)})}},{key:"on",value:function(t,e){this.bindings.push({event:t,callback:e})}},{key:"off",value:function(t){this.bindings=this.bindings.filter(function(e){return e.event!==t})}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?this.timeout:arguments[2];if(!this.joinedOnce)throw"tried to push '"+t+"' to '"+this.topic+"' before joining. Use channel.join() before pushing events";var i=new p(this,t,e,n);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}},{key:"leave",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?this.timeout:arguments[0];this.state=l.leaving;var n=function(){t.socket.log("channel","leave "+t.topic),t.trigger(u.close,"leave",t.joinRef())},i=new p(this,u.leave,{},e);return i.receive("ok",function(){return n()}).receive("timeout",function(){return n()}),i.send(),this.canPush()||i.trigger("ok",{}),i}},{key:"onMessage",value:function(t,e,n){return e}},{key:"isMember",value:function(t){return this.topic===t}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"sendJoin",value:function(t){this.state=l.joining,this.joinPush.resend(t)}},{key:"rejoin",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.timeout:arguments[0];this.isLeaving()||this.sendJoin(t)}},{key:"trigger",value:function(t,e,n){var i=u.close,o=u.error,r=u.leave,s=u.join;if(!(n&&[i,o,r,s].indexOf(t)>=0&&n!==this.joinRef())){var a=this.onMessage(t,e,n);if(e&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(function(e){return e.event===t}).map(function(t){return t.callback(a,n)})}}},{key:"replyEventName",value:function(t){return"chan_reply_"+t}},{key:"isClosed",value:function(){return this.state===l.closed}},{key:"isErrored",value:function(){return this.state===l.errored}},{key:"isJoined",value:function(){return this.state===l.joined}},{key:"isJoining",value:function(){return this.state===l.joining}},{key:"isLeaving",value:function(){return this.state===l.leaving}}]),t}(),h=(t.Socket=function(){function t(e){var n=this,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,t),this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=o.timeout||c,this.transport=o.transport||window.WebSocket||h,this.heartbeatIntervalMs=o.heartbeatIntervalMs||3e4,this.reconnectAfterMs=o.reconnectAfterMs||function(t){return[1e3,2e3,5e3,1e4][t-1]||1e4},this.logger=o.logger||function(){},this.longpollerTimeout=o.longpollerTimeout||2e4,this.params=o.params||{},this.endPoint=e+"/"+d.websocket,this.reconnectTimer=new v(function(){n.disconnect(function(){return n.connect()})},this.reconnectAfterMs)}return r(t,[{key:"protocol",value:function(){return location.protocol.match(/^https/)?"wss":"ws"}},{key:"endPointURL",value:function(){var t=m.appendParams(m.appendParams(this.endPoint,this.params),{vsn:s});return"/"!==t.charAt(0)?t:"/"===t.charAt(1)?this.protocol()+":"+t:this.protocol()+"://"+location.host+t}},{key:"disconnect",value:function(t,e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n||""):this.conn.close(),this.conn=null),t&&t()}},{key:"connect",value:function(t){var e=this;t&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=t),this.conn||(this.conn=new this.transport(this.endPointURL()),this.conn.timeout=this.longpollerTimeout,this.conn.onopen=function(){return e.onConnOpen()},this.conn.onerror=function(t){return e.onConnError(t)},this.conn.onmessage=function(t){return e.onConnMessage(t)},this.conn.onclose=function(t){return e.onConnClose(t)})}},{key:"log",value:function(t,e,n){this.logger(t,e,n)}},{key:"onOpen",value:function(t){this.stateChangeCallbacks.open.push(t)}},{key:"onClose",value:function(t){this.stateChangeCallbacks.close.push(t)}},{key:"onError",value:function(t){this.stateChangeCallbacks.error.push(t)}},{key:"onMessage",value:function(t){this.stateChangeCallbacks.message.push(t)}},{key:"onConnOpen",value:function(){var t=this;this.log("transport","connected to "+this.endPointURL(),this.transport.prototype),this.flushSendBuffer(),this.reconnectTimer.reset(),this.conn.skipHeartbeat||(clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(function(){return t.sendHeartbeat()},this.heartbeatIntervalMs)),this.stateChangeCallbacks.open.forEach(function(t){return t()})}},{key:"onConnClose",value:function(t){this.log("transport","close",t),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(function(e){return e(t)})}},{key:"onConnError",value:function(t){this.log("transport",t),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(function(e){return e(t)})}},{key:"triggerChanError",value:function(){this.channels.forEach(function(t){return t.trigger(u.error)})}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case a.connecting:return"connecting";case a.open:return"open";case a.closing:return"closing";default:return"closed"}}},{key:"isConnected",value:function(){return"open"===this.connectionState()}},{key:"remove",value:function(t){this.channels=this.channels.filter(function(e){return e.joinRef()!==t.joinRef()})}},{key:"channel",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=new f(t,e,this);return this.channels.push(n),n}},{key:"push",value:function(t){var e=this,n=t.topic,i=t.event,o=t.payload,r=t.ref,s=function(){return e.conn.send(JSON.stringify(t))};this.log("push",n+" "+i+" ("+r+")",o),this.isConnected()?s():this.sendBuffer.push(s)}},{key:"makeRef",value:function(){var t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}},{key:"sendHeartbeat",value:function(){this.isConnected()&&this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.makeRef()})}},{key:"flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(function(t){return t()}),this.sendBuffer=[])}},{key:"onConnMessage",value:function(t){var e=JSON.parse(t.data),n=e.topic,i=e.event,o=e.payload,r=e.ref;this.log("receive",(o.status||"")+" "+n+" "+i+" "+(r&&"("+r+")"||""),o),this.channels.filter(function(t){return t.isMember(n)}).forEach(function(t){return t.trigger(i,o,r)}),this.stateChangeCallbacks.message.forEach(function(t){return t(e)})}}]),t}(),t.LongPoll=function(){function t(e){i(this,t),this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=a.connecting,this.poll()}return r(t,[{key:"normalizeEndpoint",value:function(t){return t.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+d.websocket),"$1/"+d.longpoll)}},{key:"endpointURL",value:function(){return m.appendParams(this.pollEndpoint,{token:this.token})}},{key:"closeAndRetry",value:function(){this.close(),this.readyState=a.connecting}},{key:"ontimeout",value:function(){this.onerror("timeout"),this.closeAndRetry()}},{key:"poll",value:function(){var t=this;(this.readyState===a.open||this.readyState===a.connecting)&&m.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),function(e){if(e){var n=e.status,i=e.token,o=e.messages;t.token=i}else var n=0;switch(n){case 200:o.forEach(function(e){return t.onmessage({data:JSON.stringify(e)})}),t.poll();break;case 204:t.poll();break;case 410:t.readyState=a.open,t.onopen(),t.poll();break;case 0:case 500:t.onerror(),t.closeAndRetry();break;default:throw"unhandled poll status "+n}})}},{key:"send",value:function(t){var e=this;m.request("POST",this.endpointURL(),"application/json",t,this.timeout,this.onerror.bind(this,"timeout"),function(t){t&&200===t.status||(e.onerror(status),e.closeAndRetry())})}},{key:"close",value:function(t,e){this.readyState=a.closed,this.onclose()}}]),t}()),m=t.Ajax=function(){function t(){i(this,t)}return r(t,null,[{key:"request",value:function(t,e,n,i,o,r,s){if(window.XDomainRequest){var a=new XDomainRequest;this.xdomainRequest(a,t,e,i,o,r,s)}else{var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(a,t,e,n,i,o,r,s)}}},{key:"xdomainRequest",value:function(t,e,n,i,o,r,s){var a=this;t.timeout=o,t.open(e,n),t.onload=function(){var e=a.parseJSON(t.responseText);s&&s(e)},r&&(t.ontimeout=r),t.onprogress=function(){},t.send(i)}},{key:"xhrRequest",value:function(t,e,n,i,o,r,s,a){var c=this;t.timeout=r,t.open(e,n,!0),t.setRequestHeader("Content-Type",i),t.onerror=function(){a&&a(null)},t.onreadystatechange=function(){if(t.readyState===c.states.complete&&a){var e=c.parseJSON(t.responseText);a(e)}},s&&(t.ontimeout=s),t.send(o)}},{key:"parseJSON",value:function(t){return t&&""!==t?JSON.parse(t):null}},{key:"serialize",value:function(t,e){var n=[];for(var i in t)if(t.hasOwnProperty(i)){var r=e?e+"["+i+"]":i,s=t[i];"object"===("undefined"==typeof s?"undefined":o(s))?n.push(this.serialize(s,r)):n.push(encodeURIComponent(r)+"="+encodeURIComponent(s))}return n.join("&")}},{key:"appendParams",value:function(t,e){if(0===Object.keys(e).length)return t;var n=t.match(/\?/)?"&":"?";return""+t+n+this.serialize(e)}}]),t}();m.states={complete:4};var v=(t.Presence={syncState:function(t,e,n,i){var o=this,r=this.clone(t),s={},a={};return this.map(r,function(t,n){e[t]||(a[t]=n)}),this.map(e,function(t,e){var n=r[t];n?!function(){var i=e.metas.map(function(t){return t.phx_ref}),r=n.metas.map(function(t){return t.phx_ref}),c=e.metas.filter(function(t){return r.indexOf(t.phx_ref)<0}),l=n.metas.filter(function(t){return i.indexOf(t.phx_ref)<0});c.length>0&&(s[t]=e,s[t].metas=c),l.length>0&&(a[t]=o.clone(n),a[t].metas=l)}():s[t]=e}),this.syncDiff(r,{joins:s,leaves:a},n,i)},syncDiff:function(t,e,i,o){var r=e.joins,s=e.leaves,a=this.clone(t);return i||(i=function(){}),o||(o=function(){}),this.map(r,function(t,e){var o=a[t];if(a[t]=e,o){var r;(r=a[t].metas).unshift.apply(r,n(o.metas))}i(t,o,e)}),this.map(s,function(t,e){var n=a[t];if(n){var i=e.metas.map(function(t){return t.phx_ref});n.metas=n.metas.filter(function(t){return i.indexOf(t.phx_ref)<0}),o(t,n,e),0===n.metas.length&&delete a[t]}}),a},list:function(t,e){return e||(e=function(t,e){return e}),this.map(t,function(t,n){return e(t,n)})},map:function(t,e){return Object.getOwnPropertyNames(t).map(function(n){return e(n,t[n])})},clone:function(t){return JSON.parse(JSON.stringify(t))}},function(){function t(e,n){i(this,t),this.callback=e,this.timerCalc=n,this.timer=null,this.tries=0}return r(t,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var t=this;clearTimeout(this.timer),this.timer=setTimeout(function(){t.tries=t.tries+1,t.callback()},this.timerCalc(this.tries+1))}}]),t}())}("undefined"==typeof exports?window.Phoenix=window.Phoenix||{}:exports);var n=window.Phoenix.Socket,i=new n("ws://52.203.56.116:4000/socket",{transport:WebSocket});return i.connect(),i}t.module("PhoenixSocket",[]).factory("Socket",e),e.$inject=["$log"]}(angular),function(t){"use strict";t.module("frontend.socket",["PhoenixSocket"])}(angular),function(t){"use strict";t.module("frontend.api",["ngResource","api.ApiGetAllMeters","api.ApiGetMeter","api.ApiGetMeterEntries","api.ApiAllNotifications"])}(angular),function(){"use strict";function t(t){var e=this;e.states=t.get()}angular.module("frontend").controller("MainController",t),t.$inject=["$state"]}(),function(t){"use strict";function e(e){return{restrict:"A",scope:{},link:function(n,i){i.one=e.$on("$stateChangeSuccess",function(e,n,o,r){var s=t.isDefined(r.data)&&t.isDefined(r.data.cssClassnames)?r.data.cssClassnames:null,a=t.isDefined(n.data)&&t.isDefined(n.data.cssClassnames)?n.data.cssClassnames:null;s!=a&&(s&&i.removeClass(s),a&&i.addClass(a))})}}}t.module("frontend.common.routeCssClassname",[]).directive("fiRouteClassNames",e),e.$inject=["$rootScope"]}(angular),function(t){function e(t,e){var n=this;n.download=function(n,i,o){var r=new Uint8Array(n),s=new Blob([r],{type:i}),a=e[0].createElement("a");a.href=t.URL.createObjectURL(s),a.download=o,a.click()}}t.module("frontend.common.downloadFiles",[]).service("DownloadFile",e),e.$inject=["$window","$document"]}(angular),function(){"use strict";angular.module("frontend.common",["frontend.common.routeCssClassname","frontend.common.navbar","frontend.common.sidebar","frontend.common.manageEnter"])}(),function(){"use strict";function t(t){t.debug("runBlock end")}t.$inject=["$log"],angular.module("frontend").run(t)}(),function(){"use strict";function t(t,e){t.state("home",{url:"/debug-routes",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"ctrl"}),e.otherwise("/")}t.$inject=["$stateProvider","$urlRouterProvider"],angular.module("frontend").config(t)}(),function(){"use strict";angular.module("frontend").constant("moment",moment)}(),function(){"use strict";function t(t,e){t.debugEnabled(!0),e.interceptors.push("customInterceptor"),e.interceptors.push("authRedirectInterceptor")}angular.module("frontend").config(t),t.$inject=["$logProvider","$httpProvider"]}(),angular.module("frontend").run(["$templateCache",function(t){t.put("app/main/main.html",'<div class=grid><div class=row><div class="col content"><h1>App states:</h1><ul><li ng-repeat="state in ctrl.states" ng-if=state.name><a ui-sref="{{ state.name }}"><span>{{ state.name }}</span></a></li></ul></div></div></div>'),t.put("app/components/navbar/navbar.html",'<div class=navbar><a class="navbar-element navbar-user user pull-right"><span class=navbar-element-floater><span class=data><span class=name>GAS METER </span></span></span></a><button ng-click=ctrl.sendSocketData()>TEST</button> <a we-navbar-element type=link icon=bell ng-click=ctrl.goToMainNotificationMenu() counter="{{ ctrl.notReadCounter.count }}" uib-popover-template="\'app/components/popovers/popover-notifications-main.html\'" popover-placement=bottom popover-trigger=outsideClick popover-append-to-body=false position=right class=notification-icon type=link></a></div>'),t.put("app/components/popovers/popover-navbar-notifications.html",'<div class="popover-sections popover-navbar-menu-notification"><div class=popover-title>NOTIFICACIONES <span class=tag-counter>Sin leer</span><div class=circle-counter-container><div class=circle-counter>{{ctrl.notReadCounter.count}}</div></div></div><div class=popover-inner-section><div class=row><div class=col><div class=notification-item ng-repeat="notification in ctrl.notificationsDisplay | limitTo: 5"><a type=link position=right><div class=circle-container><div class=circle><i class="ic ic-calendar-o" icon=calendar-o></i></div></div><div class=notification-info><div class="big-up ellipsis"><span class=notif-title-gray>El día de hoy tienes </span><span class=notif-title-blue>{{ notification.description }}</span></div><div class=small-down>{{ notification.formatDate }}</div></div></a></div></div></div></div><div class=popover-footer><a ui-sref=notifications>VER TODOS LOS AVISOS</a></div></div>'),t.put("app/components/popovers/popover-navbar-options.html",'<div class=popover-navbar-container><div class=popover-navbar-menu><ul class=popover-navbar-menu-list><li class=popover-item-menu-item><a ui-sref=profile-config class="popover-item-anchor-item delete">Configurar perfil</a></li><li><a ng-click=ctrl.logout() class="popover-item-anchor-item delete">Cerrar sesión</a></li></ul></div></div>'),t.put("app/components/popovers/popover-notifications-main.html","<!--\nmain\ndetailed\nmeeting\ncommitteeinvitation\nboardinvitation\nmeetingchanged\nnewpublicnote\n--><div class=popover-main-container-notification ng-class=\"{\n        'main': ctrl.currentViewPopoverNotification == 'main',\n        'detailed': ctrl.currentViewPopoverNotification == 'detailed',\n        'meeting': ctrl.currentViewPopoverNotification == 'meeting',\n        'committeeinvitation': ctrl.currentViewPopoverNotification == 'committeeinvitation',\n        'boardinvitation': ctrl.currentViewPopoverNotification == 'boardinvitation',\n        'meetingchanged': ctrl.currentViewPopoverNotification == 'meetingchanged',\n        'newpublicnote': ctrl.currentViewPopoverNotification == 'newpublicnote'}\"><!--- Main view ---><div class=\"popover-sections popover-main popover-navbar-menu-notification\"><div class=popover-title>ALERTAS <button ng-if=\"ctrl.notificationsDisplay.length > 5\" ui-sref=notifications class=\"view-all button button-main button-small\">View <span class=notification-number>{{ ctrl.notificationsDisplay.length }} - 5</span> More</button> <button ng-if=\"ctrl.notificationsDisplay.length <= 5\" ui-sref=notifications class=\"view-all button button-main button-small\">Ver Mas</button></div><div class=popover-inner-section><div class=row><div class=col><div class=notification-item ng-repeat=\"notification in ctrl.notificationsDisplay | limitTo: 5\"><a href=\"\" type=link position=right><div class=circle-container><div class=circle><i class=\"fa fa-exclamation-triangle\"></i></div></div><div class=notification-info><div class=\"big-up ellipsis\"><span class=notif-title-blue>{{ notification.description }}</span></div><div class=small-down>{{ notification.inserted_at }}</div></div></a></div></div></div></div></div></div>"),t.put("app/components/sidebar/sidebar.html","<div><div we-sidebar id=sidebar><a we-sidebar-header isotype=assets/images/gas.png>name</a><ul class=sidebar-list><li><a ui-sref=metersHome ui-sref-active=option-sidebar-selected we-sidebar-link icon=home>All Meters</a></li></ul></div></div>"),
t.put("app/views/user/notifications/index.html",'<div navbar></div><div sidebar></div><div class="grid main-container"><div class="row center-xs"><div class="col xs-12 m-12 l-10 xl-9 content"><h1 class=main-title><we-icon icon=bell></we-icon>Alerts</h1><!--<div class="lower-container">--><!--<table class="data-table">--><!--<tr>--><!--<th></th>--><!--<th>Alert Description</th>--><!--<th>Day/Time</th>--><!--<th>Temperature</th>--><!--<th>Fuel Level</th>--><!--<th>Status</th>--><!--</tr>--><!--&lt;!&ndash;<tr ng-repeat="alert in ctrl.alerts">&ndash;&gt;--><!--&lt;!&ndash;<td>{{ alert.description }}</td>&ndash;&gt;--><!--&lt;!&ndash;<td>{{ alert.time }}</td>&ndash;&gt;--><!--&lt;!&ndash;<td>{{ alert.temperature }}</td>&ndash;&gt;--><!--&lt;!&ndash;<td>{{alert.level}}</td>&ndash;&gt;--><!--&lt;!&ndash;</tr>&ndash;&gt;--><!--<tr>--><!--<td><i class="fa fa-exclamation-triangle"></i></td>--><!--<td> Increase in fuel consumption From 1 L/h to 3.4L/H </td>--><!--<td> 25-6-2017 18:25 </td>--><!--<td> 26 C </td>--><!--<td> 150mm </td>--><!--<td> <button class="button button-main button-tiny read-notification-button"><i class="fa fa-eye eye-icon"></i> Mark as read</button></td>--><!--</tr>--><!--<tr>--><!--<td><i class="fa fa-exclamation-triangle"></i></td>--><!--<td> Increase in fuel consumption From 1 L/h to 3.4L/H </td>--><!--<td> 25-6-2017 18:25 </td>--><!--<td> 26 C </td>--><!--<td> 150mm </td>--><!--<td> <span class="notification-read"><i class="fa fa-check"></i> Read</span></td>--><!--</tr>--><!--</table>--><!--</div>--><div class=filter-form><div><a we-button color=gray class="left-end button-notification {{ !ctrl.showReaded ? \'button-state-readed\' : \'\'}}" size=small ng-click="">Read</a> <a we-button color=gray class="right-end button-notification {{ ctrl.showReaded ? \'button-state-readed\' : \'\'}}" size=small ng-click="">Unread</a></div><div class="col xs-12 m-6 l-7 search-option"><div we-input-wrapper class="input-wrapper component-position-right" component-position=right size=small><i class="input-mark ic ic-search" icon=search></i> <input type=text placeholder="Busca aquí una notifcación..."></div></div></div><div class="dynamic-table vertical sortable notifications-table"><div class=lower-container><table class=data-table><tr><th></th><th>Alert Description</th><th>Day/Time</th><th>Temperature</th><th>Fuel Level</th><th>Status</th></tr><!--<tr ng-repeat="alert in ctrl.alerts">--><!--<td>{{ alert.description }}</td>--><!--<td>{{ alert.time }}</td>--><!--<td>{{ alert.temperature }}</td>--><!--<td>{{alert.level}}</td>--><!--</tr>--><tr ng-repeat="alert in ctrl.alerts"><td class=notification-description><a href=""><i class="fa fa-exclamation-triangle"></i></a></td><td class=notification-description><a href="">{{ alert.description }}</a></td><td>{{ alert.inserted_at}}</td><td>{{ alert.data.temperature }}</td><td>{{ alert.data.fuel_level }}</td><td><button class="button button-main button-tiny read-notification-button" ng-click=ctrl.readNotification(alert.id)><i class="fa fa-eye eye-icon"></i> Mark as read</button></td></tr></table></div></div><div ng-if="ctrl.actualNotificationsLength === 0"><div class=content-placeholder><h2>¡Felicidades! no tienes notificaciones nuevas</h2></div></div></div></div></div>'),t.put("app/views/predictions/all-predictions/index.html",'<div navbar search-bar></div><div sidebar></div><div class="grid main-container"><div class=row><div class="col content"><h1>Gas Meters</h1><select ng-model=ctrl.selectedRegion ng-change=ctrl.change() ng-options="region as region for region in ctrl.regions"></select><table class=data-table><tr><th>Name</th><th>Latitude</th><th>Longitude</th><th>Description</th><th>Región</th><th>&nbsp;</th></tr><tr ng-if="ctrl.selectedRegion == \'All\'" ng-repeat="prediction1 in ctrl.meterList"><td>{{ prediction1.name }}</td><td>{{ prediction1.latitude }}</td><td>{{ prediction1.longitude }}</td><td>{{ prediction1.description }}</td><td>{{ prediction1.region }}</td><td><a we-button size=tiny color=warning ng-click="" ui-sref="prediction1({id: prediction1.id})">Details</a></td></tr><tr ng-if="ctrl.selectedRegion != \'All\'" ng-repeat="prediction1 in ctrl.meterList| filter:ctrl.selectedRegion"><td>{{ prediction1.name }}</td><td>{{ prediction1.latitude }}</td><td>{{ prediction1.longitude }}</td><td>{{ prediction1.description }}</td><td>{{ prediction1.region }}</td><td><a we-button size=tiny color=warning ng-click="" ui-sref="prediction1({id: prediction1.id})">Details</a></td></tr></table></div></div></div>'),t.put("app/views/predictions/prediction1/index.html",'<div navbar search-bar></div><div sidebar></div><div class="grid main-container"><button ng-click=ctrl.sendSocketData()>TEST</button><div class=row><div class="col content"><div class=grid><div class=row><div class=col><h1>Fuel Levels: {{ ctrl.prediction1.name }}</h1><h3>Current Level: {{ ctrl.currentEntries[0].level }}</h3><h3>Promedio de Gasto: 2 Galones/hora</h3><h3></h3></div><div class=col><button we-open="fill-tank-popup    " class="button button-small button-success tank-full-button">Establecer Llenado</button></div></div></div><select ng-change=ctrl.changeInputs() ng-model=ctrl.display_mode name=graph-time id=time><option value=hours>Hours</option><option value=date>Date</option></select><div class="grid input-grid"><div class=row><div ng-if="ctrl.display_mode == \'date\'" class="col-xs-8 content filters"><label class=time-label for=time-begin>Initial:</label><input type=date ng-model=ctrl.initialTime class="date-input input-small" required> <input type=date ng-model=ctrl.endTime class="date-input input-small" required><label class=time-label for=time-end>End:</label><div class="col-xs-4 content actions"><button class="button button-small refresh-axis-button" ng-click=ctrl.refreshGrid()>Refresh</button></div></div><div ng-if="ctrl.display_mode == \'hours\'" class="col-xs-8 content filters"><div class=grid><div class=row><div class=col><h3>Start:</h3></div></div><div class=row><div class="col-xs-6 date-col"><input type=date ng-model=ctrl.initialTime class="date-input input-small" required></div><div class=col-xs-6><uib-timepicker ng-model=ctrl.initialTimeHours hour-step=1 minute-step=1 readonly-input=true></uib-timepicker></div></div><div class=row><div class=col><h3>End:</h3></div></div><div class=row><div class="col-xs-6 date-col"><input type=date ng-model=ctrl.endTime class="date-input input-small" required></div><div class=col-xs-6><uib-timepicker ng-model=ctrl.endTimeHours hour-step=1 minute-step=1 readonly-input=true></uib-timepicker></div></div></div><div class="col-xs-4 content actions"><button class="button button-small refresh-axis-button" ng-click=ctrl.refreshGrid()>Refresh</button></div></div><canvas id=line class="chart chart-line" chart-data=ctrl.data chart-labels=ctrl.labels chart-series=ctrl.series chart-options=ctrl.options chart-dataset-override=ctrl.datasetOverride chart-click=onClick></canvas></div></div><div class=row><div class="col content"><h1>Report</h1><div class=log-container><table class=data-table><tr><th>Day/Time</th><th>Temperature</th><th>Fuel Level</th></tr><tr ng-repeat="logentry in ctrl.logEntries"><td>{{ logentry.time }}</td><td>{{ logentry.temperature }}</td><td>{{logentry.level}}</td></tr><!--<tr ng-repeat="prediction1 in ctrl.meterList">--><!--<td>{{ prediction1.name }}</td>--><!--<td>{{ prediction1.level }}</td>--><!--<td>{{ prediction1.temperature}}</td>--><!--<td>--><!--<a we-button size="tiny" color="warning" ng-click="" we-open="edit-board-popup">Details</a>--><!--</td>--><!--</tr>--></table></div></div></div></div><!-- Confirm fill tank popup --><div we-popup id=fill-tank-popup class="fill-tank-popup new-member-popup first-config-popup"><div class="popup-content content-fill-tank"><button class=popup-close we-close></button><p class=subheader>Establecer Llenado:</p><h1>¿Estás seguro de quieres establecer como lleno el tanque?</h1><p class=paragraph-delete>Al realizar esta acción se establecerá el nivel actual del tanque como el nivel de tanque lleno.</p></div><div class="popup-actions actions-delete"><button we-button we-close color=gray>cancelar</button> <button we-button type=submit ng-click=ctrl.setTankFull() color=success class=button-delete ng-disabled=meetingForm.$invalid>Establecer</button></div></div></div></div>')}]);